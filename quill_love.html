<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì„¯ ë²ˆì˜ í¸ì§€ì™€ í•˜ë‚˜ì˜ ë‹µì¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2c1810, #4a3428);
            color: #f4f1e8;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #d4af37;
        }

        .game-title {
            font-size: 2.5em;
            color: #d4af37;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-subtitle {
            font-size: 1.2em;
            color: #c9b037;
            font-style: italic;
        }

        /* ìºë¦­í„° ë©”ì´í‚¹ */
        .character-creation {
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8em;
            color: #d4af37;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 10px;
        }

        .character-form {
            display: grid;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .form-label {
            font-weight: bold;
            color: #d4af37;
            min-width: 80px;
        }

        .form-input, .form-select {
            background: rgba(0,0,0,0.3);
            border: 1px solid #d4af37;
            border-radius: 5px;
            padding: 8px 12px;
            color: #f4f1e8;
            min-width: 150px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #f4f1e8;
            background: rgba(0,0,0,0.5);
        }

        .abilities-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .ability-item {
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .ability-name {
            font-weight: bold;
            color: #d4af37;
            font-size: 0.9em;
        }

        .ability-value {
            font-size: 1.2em;
            margin-top: 5px;
        }

        .ability-good { color: #4CAF50; }
        .ability-normal { color: #FFC107; }
        .ability-bad { color: #F44336; }

        /* í¸ì§€ ì‘ì„± í™”ë©´ */
        .letter-interface {
            display: none;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .letter-sidebar {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
        }

        .letter-main {
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 10px;
        }

        .letter-number {
            font-size: 1.8em;
            color: #d4af37;
            margin-bottom: 15px;
            text-align: center;
        }

        .judgement-section {
            margin-bottom: 25px;
        }

        .judgement-title {
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 5px;
        }

        .judgement-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(212, 175, 55, 0.05);
            border-radius: 3px;
        }

        .judgement-label {
            font-size: 0.9em;
            color: #c9b037;
        }

        .judgement-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #d4af37;
        }

        .dice-section {
            background: rgba(212, 175, 55, 0.05);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .dice-info {
            font-size: 0.9em;
            color: #c9b037;
            margin-bottom: 8px;
        }

        .dice-btn {
            background: linear-gradient(135deg, #d4af37, #c9b037);
            color: #2c1810;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .dice-btn:hover {
            transform: translateY(-1px);
        }

        .dice-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .dice-result {
            font-size: 0.8em;
            color: #f4f1e8;
            min-height: 20px;
        }

        .dice-success {
            color: #4CAF50;
            font-weight: bold;
        }

        .dice-failure {
            color: #F44336;
            font-weight: bold;
        }

        .word-bank {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .word-bank-title {
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .word-pairs {
            display: grid;
            gap: 8px;
        }

        .word-pair {
            background: rgba(212, 175, 55, 0.1);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            text-align: center;
            font-size: 0.9em;
        }

        .passive-word {
            color: #888;
            font-style: italic;
        }

        .active-word {
            color: #d4af37;
            font-weight: bold;
        }

        .letter-prompt {
            font-size: 1.1em;
            color: #f4f1e8;
            background: rgba(212, 175, 55, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #d4af37;
        }

        .letter-editor {
            background: #f4f1e8;
            color: #2c1810;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 350px;
            font-family: 'Georgia', serif;
            font-size: 1.1em;
            line-height: 1.8;
            border: none;
            outline: none;
            resize: vertical;
            width: 100%;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .letter-editor::placeholder {
            color: #666;
            font-style: italic;
        }

        .score-display {
            background: rgba(212, 175, 55, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .score-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            display: block;
            color: #c9b037;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .score-value {
            display: block;
            color: #d4af37;
            font-size: 1.6em;
            font-weight: bold;
        }

        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #d4af37, #c9b037);
            color: #2c1810;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .story-section {
            background: rgba(0,0,0,0.5);
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #d4af37;
            display: none;
        }

        .story-title {
            color: #d4af37;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .story-content {
            font-size: 1.1em;
            line-height: 1.8;
            text-align: justify;
        }

        @media (max-width: 1024px) {
            .letter-interface {
                grid-template-columns: 1fr;
            }
            
            .letter-sidebar {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .abilities-display {
                grid-template-columns: 1fr;
            }
            
            .score-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">ë‹¤ì„¯ ë²ˆì˜ í¸ì§€ì™€ í•˜ë‚˜ì˜ ë‹µì¥</h1>
            <p class="game-subtitle">ìµëª…ì˜ í›„ì›ìì—ê²Œ ë³´ë‚´ëŠ” ì‚¬ë‘ì˜ í¸ì§€</p>
        </div>

        <!-- ì‹œë‚˜ë¦¬ì˜¤ ì†Œê°œ -->
        <div class="character-creation" id="scenarioIntro">
            <h2 class="section-title">ì‹œë‚˜ë¦¬ì˜¤ ì†Œê°œ</h2>
            <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <p style="margin-bottom: 15px;">ê¸´ ë¬´ëª… ìƒí™œì— ì§€ì³ê°€ë˜ ì–´ëŠ ë‚ , ì´ë¦„ë„ ì–¼êµ´ë„ ëª¨ë¥´ëŠ” ìµëª…ì˜ í›„ì›ìë¡œë¶€í„° í›„ì›ê¸ˆì„ ë°›ê²Œ ëœë‹¤.</p>
                <p style="margin-bottom: 15px;">ê·¸ëŠ” í•œë§ˆë”” ë§ë„ ì—†ì´ ìì‹ ì˜ ì‚¬ìš©ì¸ì„ í†µí•´ í›„ì›ê¸ˆì„ ì „ë‹¬í•  ë¿, ê·¸ ì–´ë–¤ ì‹ ìƒ ì •ë³´ë„ ì•Œë ¤ì£¼ì§€ ì•ŠëŠ”ë‹¤.</p>
                <p>ì–´ëŠ ë‚ , ì£¼ì¸ê³µì€ ë¬¸ë“ ê·¸ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ ë– ì˜¬ë¼ íœì„ ë“¤ì–´ í¸ì§€ë¥¼ ì“°ê¸° ì‹œì‘í•œë‹¤.</p>
            </div>
            <div class="action-buttons">
                <button class="btn" onclick="showCharacterCreation()">ìºë¦­í„° ë§Œë“¤ê¸°</button>
            </div>
        </div>

        <!-- ìºë¦­í„° ë©”ì´í‚¹ -->
        <div class="character-creation" id="characterCreation" style="display: none;">
            <h2 class="section-title">ìºë¦­í„° ë©”ì´í‚¹</h2>
            <div class="character-form">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="characterName" placeholder="ì˜ˆìˆ ê°€ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ì§ì—…</label>
                    <select class="form-select" id="characterProfession" onchange="updateAbilities()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="writer">ì‘ê°€</option>
                        <option value="painter">í™”ê°€</option>
                        <option value="musician">ìŒì•…ê°€</option>
                    </select>
                </div>

                <div class="abilities-display">
                    <div class="ability-item">
                        <div class="ability-name">ê°ì •</div>
                        <div class="ability-value" id="emotion">-</div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-name">ë¬¸ì¥ë ¥</div>
                        <div class="ability-value" id="language">-</div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-name">í•„ì²´</div>
                        <div class="ability-value" id="penmanship">-</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ê¸°ìˆ </label>
                    <select class="form-select" id="characterSkill">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="inspiration">ì˜ê° (ë¬¸ì¥ë ¥ íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                        <option value="elegance">í™”ë ¤í•¨ (í•„ì²´ íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                        <option value="passion">ë¶€í‘¼ ê°ì • (ê°ì • íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                    </select>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" id="startGameBtn" onclick="startGame()" disabled>ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <!-- í¸ì§€ ì‘ì„± ì¸í„°í˜ì´ìŠ¤ -->
        <div class="letter-interface" id="letterInterface">
            <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
            <div class="letter-sidebar">
                <div class="letter-number" id="letterNumber">ì²« ë²ˆì§¸ í¸ì§€</div>
                
                <!-- ì£¼ì‚¬ìœ„ íŒì • -->
                <div class="judgement-section">
                    <div class="judgement-title">ğŸ² ê°ì • íŒì • (ë¯¸ì‚¬ì—¬êµ¬)</div>
                    <div class="dice-section">
                        <div class="dice-info">
                            <span id="emotionDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„
                        </div>
                        <button class="dice-btn" id="emotionRollBtn" onclick="rollEmotion()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                        <div class="dice-result" id="emotionResult"></div>
                    </div>
                </div>

                <div class="judgement-section">
                    <div class="judgement-title">ğŸ² ë¬¸ì¥ë ¥ íŒì •</div>
                    <div class="dice-section">
                        <div class="dice-info">
                            <span id="languageDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„
                        </div>
                        <button class="dice-btn" id="languageRollBtn" onclick="rollLanguage()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                        <div class="dice-result" id="languageResult"></div>
                    </div>
                </div>

                <div class="judgement-section">
                    <div class="judgement-title">ğŸ² í•„ì²´ íŒì •</div>
                    <div class="dice-section">
                        <div class="dice-info">
                            <span id="penmanshipDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„
                        </div>
                        <button class="dice-btn" id="penmanshipRollBtn" onclick="rollPenmanship()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                        <div class="dice-result" id="penmanshipResult"></div>
                    </div>
                </div>

                <div class="judgement-section">
                    <div class="judgement-title">âš¡ ê¸°ìˆ  ì‚¬ìš©</div>
                    <div class="judgement-row">
                        <span class="judgement-label" id="skillLabel">ë¯¸ì‚¬ìš©</span>
                        <input type="checkbox" class="judgement-checkbox" id="skillCheck">
                    </div>
                    <div style="font-size: 0.7em; color: #888; margin-top: 5px; text-align: center;">
                        ê¸°ìˆ  ì‚¬ìš© ì‹œ í•´ë‹¹ ëŠ¥ë ¥ì¹˜ì—<br>ì£¼ì‚¬ìœ„ +1ê°œ ì¶”ê°€
                    </div>
                </div>

                <!-- ë‹¨ì–´ ì€í–‰ -->
                <div class="word-bank">
                    <div class="word-bank-title">ğŸ’­ ë‹¨ì–´ ì€í–‰</div>
                    <div class="word-pairs" id="wordBank">
                        <!-- ë‹¨ì–´ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ì ìˆ˜ ê³„ì‚° ì•ˆë‚´ -->
                <div class="word-bank">
                    <div class="word-bank-title">ğŸ“Š ì ìˆ˜ ê³„ì‚°ë²•</div>
                    <div style="font-size: 0.8em; color: #c9b037; line-height: 1.4;">
                        <div style="margin-bottom: 8px;"><strong>ê°ì •+ë¬¸ì¥ë ¥:</strong></div>
                        <div>â€¢ ë‘˜ ë‹¤ ì„±ê³µ: +2ì </div>
                        <div>â€¢ ê°ì •ì„±ê³µ+ë¬¸ì¥ì‹¤íŒ¨: -1ì </div>
                        <div>â€¢ ê°ì •ì‹¤íŒ¨+ë¬¸ì¥ì„±ê³µ: +1ì </div>
                        <div>â€¢ ë‘˜ ë‹¤ ì‹¤íŒ¨: 0ì </div>
                        <div style="margin: 8px 0;"><strong>í•„ì²´ ì„±ê³µ: +1ì </strong></div>
                        <div style="font-size: 0.7em; color: #888;">ê°ì • íŒì •ì€ ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>

            <!-- ìš°ì¸¡ ë©”ì¸ -->
            <div class="letter-main">
                <div class="letter-prompt" id="letterPrompt">
                    ìµëª…ì˜ í›„ì›ìì—ê²Œ ì²« í¸ì§€ë¥¼ ì¨ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ì˜ˆìˆ ì— ëŒ€í•œ í›„ì›ì— ê°ì‚¬ë¥¼ í‘œí•˜ë©°, ì•ìœ¼ë¡œì˜ ì°½ì‘ ê³„íšì„ ì´ì•¼ê¸°í•´ë³´ì„¸ìš”.
                </div>

                <textarea class="letter-editor" id="letterEditor" placeholder="ì¹œì• í•˜ëŠ” í›„ì›ìë‹˜ê»˜,

í›„ì›í•´ì£¼ì‹  ë•ë¶„ì— ì œê°€ ì˜ˆìˆ ì— ì „ë…í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤..."></textarea>

                <div class="score-display">
                    <div class="score-row">
                        <div class="score-item">
                            <span class="score-label">ë‹¨ì–´+ê°ì •</span>
                            <span class="score-value" id="wordEmotionScore">0</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">í•„ì²´</span>
                            <span class="score-value" id="penmanshipScore">0</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">í¸ì§€ ì ìˆ˜</span>
                            <span class="score-value" id="letterScore">0</span>
                        </div>
                    </div>
                    <div class="score-row">
                        <div class="score-item">
                            <span class="score-label">ì´ ì ìˆ˜</span>
                            <span class="score-value" id="totalScore">0</span>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" id="calculateScoreBtn" onclick="calculateScore()">ì ìˆ˜ ê³„ì‚°</button>
                    <button class="btn" id="nextStepBtn" onclick="nextStep()" disabled>ë‹¤ìŒ ë‹¨ê³„</button>
                </div>
            </div>
        </div>

        <!-- ìŠ¤í† ë¦¬ ì„¹ì…˜ -->
        <div class="story-section" id="storySection">
            <div class="story-title" id="storyTitle">ì²« ë²ˆì§¸ ë§Œë‚¨</div>
            <div class="story-content" id="storyContent">
                <!-- ìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="action-buttons">
                <button class="btn" onclick="continueToNextLetter()">ë‹¤ìŒ í¸ì§€ ì“°ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            character: {
                name: '',
                profession: '',
                abilities: {emotion: 0, language: 0, penmanship: 0},
                skill: ''
            },
            currentLetter: 1,
            totalScore: 0,
            letterScores: [],
            skillUsed: false,
            currentRolls: {
                emotion: null,
                language: null,
                penmanship: null
            }
        };

        const professionData = {
            writer: {emotion: 1, language: 3, penmanship: 2},    // ë‚˜ì¨/ì¢‹ìŒ/ë³´í†µ
            painter: {emotion: 2, language: 1, penmanship: 3},   // ë³´í†µ/ë‚˜ì¨/ì¢‹ìŒ
            musician: {emotion: 3, language: 2, penmanship: 1}   // ì¢‹ìŒ/ë³´í†µ/ë‚˜ì¨
        };

        const letterPrompts = {
            1: "ìµëª…ì˜ í›„ì›ìì—ê²Œ ì²« í¸ì§€ë¥¼ ì¨ë³´ì„¸ìš”. ë‹¹ì‹ ì˜ ì˜ˆìˆ ì— ëŒ€í•œ í›„ì›ì— ê°ì‚¬ë¥¼ í‘œí•˜ë©°, ì•ìœ¼ë¡œì˜ ì°½ì‘ ê³„íšì„ ì´ì•¼ê¸°í•´ë³´ì„¸ìš”.",
            2: "ì˜¤ëŠ˜ í¥ë¯¸ë¡œìš´ ë¶„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ê·¸ë¶„ê³¼ì˜ ë§Œë‚¨ì„ í›„ì›ìë‹˜ê»˜ ì´ì•¼ê¸°í•´ë³´ì„¸ìš”.",
            3: "ê·¸ë¶„ì„ ë‹¤ì‹œ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì ì  ê¹Šì–´ì§€ëŠ” ê°ì •ì„ í›„ì›ìë‹˜ê»˜ í„¸ì–´ë†“ì•„ë³´ì„¸ìš”.",
            4: "ê·¸ë¶„ì„ ì‚¬ë‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. í›„ì›ìë‹˜ê»˜ ì´ ë§ˆìŒì„ ê³ ë°±í•´ë³´ì„¸ìš”.",
            5: "ë§ˆì§€ë§‰ í¸ì§€ì…ë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ì˜ ë§ˆìŒì„ ì •ë¦¬í•˜ì—¬ ì¨ë³´ì„¸ìš”."
        };

        const wordBanks = {
            1: [
                {passive: "ê·¸ë¦¼", active: "ì˜í˜¼ì„ ë‹´ì€ ìº”ë²„ìŠ¤"},
                {passive: "ëˆ", active: "ì†Œì¤‘í•œ í›„ì›"},
                {passive: "ì‘ì—…ì‹¤", active: "ì°½ì‘ì˜ ì„±ì†Œ"},
                {passive: "ë¶“", active: "ë§ˆìŒì„ ê·¸ë¦¬ëŠ” ë¶“"},
                {passive: "ê°ì‚¬", active: "ê¹Šì€ ê°ëª…"},
                {passive: "ë¯¸ë˜", active: "ì°¬ë€í•œ ì „ë§"}
            ],
            2: [
                {passive: "ì‚¬ëŒ", active: "ì‹ ë¹„ë¡œìš´ ë¶„"},
                {passive: "ë§Œë‚¨", active: "ìš´ëª…ì  ì¡°ìš°"},
                {passive: "ëŒ€í™”", active: "ë§ˆìŒ ê¹Šì€ ëŒ€í™”"},
                {passive: "ëˆˆ", active: "ë³„ë¹› ê°™ì€ ëˆˆë™ì"},
                {passive: "ì›ƒìŒ", active: "ì€ì€í•œ ë¯¸ì†Œ"},
                {passive: "ì‹œê°„", active: "í™©í™€í•œ ì‹œê°„"}
            ],
            3: [
                {passive: "ë˜", active: "ë‹¤ì‹œê¸ˆ"},
                {passive: "ë§ˆìŒ", active: "ë–¨ë¦¬ëŠ” ê°€ìŠ´"},
                {passive: "ìƒê°", active: "ê·¸ë¦¬ìš´ ë§ˆìŒ"},
                {passive: "ë°¤", active: "ì  ëª» ë“œëŠ” ë°¤"},
                {passive: "ê¿ˆ", active: "ë‹¬ì½¤í•œ ê¿ˆ"},
                {passive: "ê¸°ë‹¤ë¦¼", active: "ê°„ì ˆí•œ ê¸°ë‹¤ë¦¼"}
            ],
            4: [
                {passive: "ì‚¬ë‘", active: "ê¹Šì€ ì‚¬ë‘"},
                {passive: "ë§ˆìŒ", active: "ë¶ˆíƒ€ëŠ” ë§ˆìŒ"},
                {passive: "ê³ ë°±", active: "ì§„ì‹¬ ì–´ë¦° ê³ ë°±"},
                {passive: "ê°ì •", active: "íƒ€ì˜¤ë¥´ëŠ” ê°ì •"},
                {passive: "ì›í•¨", active: "ê°„ì ˆí•œ ë°”ëŒ"},
                {passive: "í•¨ê»˜", active: "ì˜ì›íˆ í•¨ê»˜"}
            ],
            5: [
                {passive: "ë", active: "ìƒˆë¡œìš´ ì‹œì‘"},
                {passive: "ê°ì‚¬", active: "ë¬´í•œí•œ ê°ì‚¬"},
                {passive: "ê¸°ì–µ", active: "ì†Œì¤‘í•œ ê¸°ì–µ"},
                {passive: "ì•ìœ¼ë¡œ", active: "ì°¬ë€í•œ ë¯¸ë˜"},
                {passive: "ë§ˆìŒ", active: "ë³€ì¹˜ ì•ŠëŠ” ë§ˆìŒ"},
                {passive: "í¸ì§€", active: "ë§ˆì§€ë§‰ í¸ì§€"}
            ]
        };

        function showCharacterCreation() {
            document.getElementById('scenarioIntro').style.display = 'none';
            document.getElementById('characterCreation').style.display = 'block';
        }

        function updateAbilities() {
            const profession = document.getElementById('characterProfession').value;
            if (!profession) return;

            const abilities = professionData[profession];
            const abilityNames = ['ë‚˜ì¨', 'ë³´í†µ', 'ì¢‹ìŒ'];
            const abilityClasses = ['ability-bad', 'ability-normal', 'ability-good'];

            document.getElementById('emotion').textContent = abilityNames[abilities.emotion - 1];
            document.getElementById('emotion').className = abilityClasses[abilities.emotion - 1];

            document.getElementById('language').textContent = abilityNames[abilities.language - 1];
            document.getElementById('language').className = abilityClasses[abilities.language - 1];

            document.getElementById('penmanship').textContent = abilityNames[abilities.penmanship - 1];
            document.getElementById('penmanship').className = abilityClasses[abilities.penmanship - 1];

            checkFormComplete();
        }

        function checkFormComplete() {
            const name = document.getElementById('characterName').value.trim();
            const profession = document.getElementById('characterProfession').value;
            const skill = document.getElementById('characterSkill').value;

            document.getElementById('startGameBtn').disabled = !(name && profession && skill);
        }

        document.getElementById('characterName').addEventListener('input', checkFormComplete);
        document.getElementById('characterSkill').addEventListener('change', checkFormComplete);

        function startGame() {
            // ìºë¦­í„° ì •ë³´ ì €ì¥
            gameState.character.name = document.getElementById('characterName').value.trim();
            gameState.character.profession = document.getElementById('characterProfession').value;
            gameState.character.abilities = professionData[gameState.character.profession];
            gameState.character.skill = document.getElementById('characterSkill').value;

            // í™”ë©´ ì „í™˜
            document.getElementById('characterCreation').style.display = 'none';
            document.getElementById('letterInterface').style.display = 'grid';

            // ì²« ë²ˆì§¸ í¸ì§€ ë¡œë“œ
            loadLetter(1);
        }

        function loadLetter(letterNum) {
            gameState.currentLetter = letterNum;
            
            const letterNumbers = ['', 'ì²« ë²ˆì§¸', 'ë‘ ë²ˆì§¸', 'ì„¸ ë²ˆì§¸', 'ë„¤ ë²ˆì§¸', 'ë‹¤ì„¯ ë²ˆì§¸'];
            document.getElementById('letterNumber').textContent = letterNumbers[letterNum] + ' í¸ì§€';
            document.getElementById('letterPrompt').textContent = letterPrompts[letterNum];
            
            // í¸ì§€ ì—ë””í„° ì´ˆê¸°í™”
            document.getElementById('letterEditor').value = '';
            
            // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ê²°ê³¼ ì´ˆê¸°í™”
            gameState.currentRolls = {emotion: null, language: null, penmanship: null};
            document.getElementById('emotionResult').textContent = '';
            document.getElementById('languageResult').textContent = '';
            document.getElementById('penmanshipResult').textContent = '';
            
            // ì£¼ì‚¬ìœ„ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('emotionRollBtn').disabled = false;
            document.getElementById('languageRollBtn').disabled = false;
            document.getElementById('penmanshipRollBtn').disabled = false;
            
            // ëŠ¥ë ¥ì¹˜ë³„ ì£¼ì‚¬ìœ„ ê°œìˆ˜ ì„¤ì •
            updateDiceCount();
            
            // ê¸°ìˆ  ë¼ë²¨ ì—…ë°ì´íŠ¸
            const skillLabels = {
                inspiration: 'ì˜ê°',
                elegance: 'í™”ë ¤í•¨',
                passion: 'ë¶€í‘¼ ê°ì •'
            };
            document.getElementById('skillLabel').textContent = gameState.skillUsed ? 'ì‚¬ìš©ë¨' : skillLabels[gameState.character.skill];
            document.getElementById('skillCheck').disabled = gameState.skillUsed;
            document.getElementById('skillCheck').checked = false;
            
            // ë‹¨ì–´ ì€í–‰ ë¡œë“œ
            loadWordBank(letterNum);
            
            // ì ìˆ˜ í‘œì‹œ ì´ˆê¸°í™”
            updateScoreDisplay(0, 0, 0, 0);
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('calculateScoreBtn').disabled = false;
            document.getElementById('nextStepBtn').disabled = true;
        }

        function updateDiceCount() {
            const abilities = gameState.character.abilities;
            document.getElementById('emotionDiceCount').textContent = abilities.emotion;
            document.getElementById('languageDiceCount').textContent = abilities.language;
            document.getElementById('penmanshipDiceCount').textContent = abilities.penmanship;
        }

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° í•¨ìˆ˜ë“¤
        function rollEmotion() {
            let diceCount = gameState.character.abilities.emotion;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤ ì²´í¬
            if (document.getElementById('skillCheck').checked && gameState.character.skill === 'passion') {
                diceCount += 1;
            }
            
            const result = rollDice(diceCount);
            gameState.currentRolls.emotion = result.success;
            
            document.getElementById('emotionResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ! (5+ ë‚˜ì˜´)' : 'ì‹¤íŒ¨ (ëª¨ë‘ 4 ì´í•˜)'}</span>`;
            
            document.getElementById('emotionRollBtn').disabled = true;
        }

        function rollLanguage() {
            let diceCount = gameState.character.abilities.language;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤ ì²´í¬
            if (document.getElementById('skillCheck').checked && gameState.character.skill === 'inspiration') {
                diceCount += 1;
            }
            
            const result = rollDice(diceCount);
            gameState.currentRolls.language = result.success;
            
            document.getElementById('languageResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ! (5+ ë‚˜ì˜´)' : 'ì‹¤íŒ¨ (ëª¨ë‘ 4 ì´í•˜)'}</span>`;
            
            document.getElementById('languageRollBtn').disabled = true;
        }

        function rollPenmanship() {
            let diceCount = gameState.character.abilities.penmanship;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤ ì²´í¬
            if (document.getElementById('skillCheck').checked && gameState.character.skill === 'elegance') {
                diceCount += 1;
            }
            
            const result = rollDice(diceCount);
            gameState.currentRolls.penmanship = result.success;
            
            document.getElementById('penmanshipResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ! (5+ ë‚˜ì˜´)' : 'ì‹¤íŒ¨ (ëª¨ë‘ 4 ì´í•˜)'}</span>`;
            
            document.getElementById('penmanshipRollBtn').disabled = true;
        }

        function rollDice(count) {
            const rolls = [];
            let hasSuccess = false;
            
            for (let i = 0; i < count; i++) {
                const roll = Math.floor(Math.random() * 6) + 1;
                rolls.push(roll);
                if (roll >= 5) {
                    hasSuccess = true;
                }
            }
            
            return {
                rolls: rolls,
                success: hasSuccess
            };
        }

        function loadWordBank(letterNum) {
            const wordBankEl = document.getElementById('wordBank');
            wordBankEl.innerHTML = '';
            
            wordBanks[letterNum].forEach(pair => {
                const pairEl = document.createElement('div');
                pairEl.className = 'word-pair';
                pairEl.innerHTML = `
                    <span class="passive-word">${pair.passive}</span><br>
                    <span class="active-word">${pair.active}</span>
                `;
                wordBankEl.appendChild(pairEl);
            });
        }

        function calculateScore() {
            // ëª¨ë“  í•„ìˆ˜ íŒì •ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (gameState.currentRolls.language === null || gameState.currentRolls.penmanship === null) {
                alert('ë¬¸ì¥ë ¥ íŒì •ê³¼ í•„ì²´ íŒì •ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const letterText = document.getElementById('letterEditor').value;
            
            // í€¼ì˜ ì •í™•í•œ ì ìˆ˜ ê³„ì‚° ë°©ì‹
            let letterScore = 0;
            
            // 1. ê°ì • + ë¬¸ì¥ë ¥ ì¡°í•© ì ìˆ˜
            if (gameState.currentRolls.emotion !== null) {
                // ê°ì • íŒì •ì„ í–ˆì„ ê²½ìš°
                if (gameState.currentRolls.emotion && gameState.currentRolls.language) {
                    // ê°ì • ì„±ê³µ + ë¬¸ì¥ë ¥ ì„±ê³µ = 2ì  (ê³ ìƒí•œ ë‹¨ì–´ + ë¯¸ì‚¬ì—¬êµ¬)
                    letterScore += 2;
                } else if (gameState.currentRolls.emotion && !gameState.currentRolls.language) {
                    // ê°ì • ì„±ê³µ + ë¬¸ì¥ë ¥ ì‹¤íŒ¨ = -1ì  (ì²œë°•í•œ ë‹¨ì–´ + ë¯¸ì‚¬ì—¬êµ¬)
                    letterScore -= 1;
                } else if (!gameState.currentRolls.emotion && gameState.currentRolls.language) {
                    // ê°ì • ì‹¤íŒ¨ + ë¬¸ì¥ë ¥ ì„±ê³µ = 1ì  (ê³ ìƒí•œ ë‹¨ì–´ë§Œ)
                    letterScore += 1;
                }
                // ê°ì • ì‹¤íŒ¨ + ë¬¸ì¥ë ¥ ì‹¤íŒ¨ = 0ì 
            } else {
                // ê°ì • íŒì •ì„ í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°
                if (gameState.currentRolls.language) {
                    // ë¬¸ì¥ë ¥ ì„±ê³µ = 1ì  (ê³ ìƒí•œ ë‹¨ì–´ë§Œ)
                    letterScore += 1;
                }
                // ë¬¸ì¥ë ¥ ì‹¤íŒ¨ = 0ì 
            }
            
            // 2. í•„ì²´ ì ìˆ˜
            if (gameState.currentRolls.penmanship) {
                letterScore += 1;
            }
            
            // 3. ê¸°ìˆ  ì‚¬ìš© ì²´í¬
            if (document.getElementById('skillCheck').checked && !gameState.skillUsed) {
                gameState.skillUsed = true;
                document.getElementById('skillLabel').textContent = 'ì‚¬ìš©ë¨';
                document.getElementById('skillCheck').disabled = true;
            }
            
            // ì ìˆ˜ ì €ì¥
            gameState.letterScores.push(letterScore);
            gameState.totalScore += letterScore;
            
            // ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const wordEmotionScore = letterScore - (gameState.currentRolls.penmanship ? 1 : 0);
            const penmanshipScore = gameState.currentRolls.penmanship ? 1 : 0;
            
            updateScoreDisplay(
                wordEmotionScore, 
                0, // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë§¤ê°œë³€ìˆ˜
                penmanshipScore, 
                letterScore
            );
            
            // ì‚¬ìš©ëœ ë‹¨ì–´ í‘œì‹œ
            showUsedWords(letterText, gameState.currentLetter);
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('calculateScoreBtn').disabled = true;
            document.getElementById('nextStepBtn').disabled = false;
        }

        function showUsedWords(text, letterNum) {
            // ì‚¬ìš©ëœ ê³ ìƒí•œ ë‹¨ì–´ë“¤ í•˜ì´ë¼ì´íŠ¸
            wordBanks[letterNum].forEach(pair => {
                if (text.includes(pair.active)) {
                    // ë‹¨ì–´ ì€í–‰ì—ì„œ í•´ë‹¹ ë‹¨ì–´ë¥¼ í•˜ì´ë¼ì´íŠ¸
                    const wordPairs = document.querySelectorAll('.word-pair');
                    wordPairs.forEach(element => {
                        if (element.textContent.includes(pair.active)) {
                            element.style.background = 'rgba(76, 175, 80, 0.3)';
                            element.style.borderColor = '#4CAF50';
                        }
                    });
                }
            });
        }

        function countActiveWords(text, letterNum) {
            let count = 0;
            wordBanks[letterNum].forEach(pair => {
                if (text.includes(pair.active)) {
                    count++;
                }
            });
            return count;
        }

        function updateScoreDisplay(wordEmotion, unused, penmanship, letter) {
            document.getElementById('wordEmotionScore').textContent = wordEmotion;
            document.getElementById('penmanshipScore').textContent = penmanship;
            document.getElementById('letterScore').textContent = letter;
            document.getElementById('totalScore').textContent = gameState.totalScore;
        }

        function nextStep() {
            if (gameState.currentLetter < 4) {
                // ìŠ¤í† ë¦¬ í‘œì‹œ
                showStory(gameState.currentLetter);
            } else if (gameState.currentLetter === 4) {
                // ë§ˆì§€ë§‰ í¸ì§€
                loadLetter(5);
            } else {
                // ê²Œì„ ì¢…ë£Œ
                showEnding();
            }
        }

        function showStory(storyNum) {
            document.getElementById('letterInterface').style.display = 'none';
            document.getElementById('storySection').style.display = 'block';
            
            const stories = {
                1: {
                    title: "ì²« ë²ˆì§¸ ë§Œë‚¨",
                    content: "ë‹¹ì‹ ì´ í¸ì§€ë¥¼ ë³´ë‚¸ ë©°ì¹  í›„, ì‹œì¥ì—ì„œ ìš°ì—°íˆ í•œ ë¶„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ê·¸ë¶„ì€ ë‹¹ì‹ ì˜ ì‘í’ˆì— ëŒ€í•´ ë†€ë¼ìš´ ì§€ì‹ì„ ê°€ì§€ê³  ìˆì—ˆê³ , ì˜ˆìˆ ì— ëŒ€í•œ ê¹Šì€ ì´í•´ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ê·¸ë¶„ê³¼ì˜ ëŒ€í™”ì—ì„œ ë¬˜í•œ ì¹œë°€ê°ì„ ëŠê¼ˆìŠµë‹ˆë‹¤..."
                },
                2: {
                    title: "ë‘ ë²ˆì§¸ ë§Œë‚¨", 
                    content: "ë©°ì¹  í›„, ë‹¹ì‹ ì€ ë‹¤ì‹œ ê·¸ë¶„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ë” ì˜¤ëœ ì‹œê°„ í•¨ê»˜ ë³´ëƒˆê³ , ê·¸ë¶„ì˜ ë”°ëœ»í•œ ë§ˆìŒê³¼ ì§€í˜œë¡œìš´ ë§ì”€ì— ê¹Šì€ ê°ëª…ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. í˜¹ì‹œ ì´ë¶„ì´... í•˜ëŠ” ìƒê°ì´ ìŠ¤ì³¤ì§€ë§Œ, ì„¤ë§ˆ í•˜ë©° ê³ ê°œë¥¼ ì €ì—ˆìŠµë‹ˆë‹¤..."
                },
                3: {
                    title: "ê¹¨ë‹¬ìŒì˜ ìˆœê°„",
                    content: "ë‹¹ì‹ ì˜ ë§ˆìŒì€ ì´ë¯¸ ê·¸ë¶„ì—ê²Œ í–¥í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë°¤ë§ˆë‹¤ ê·¸ë¶„ì„ ë– ì˜¬ë¦¬ë©° ì ë“¤ì—ˆê³ , ì•„ì¹¨ë§ˆë‹¤ ê·¸ë¶„ì„ ë§Œë‚  ìƒê°ì— ê°€ìŠ´ì´ ë›°ì—ˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ ì‚¬ë‘ì´ë¼ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ì„ ë•Œ, ë‹¹ì‹ ì€ ì´ ë§ˆìŒì„ ëˆ„êµ°ê°€ì—ê²Œ í„¸ì–´ë†“ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤..."
                },
                4: {
                    title: "ì§„ì‹¤ì˜ ìˆœê°„",
                    content: "ë‹¹ì‹ ì˜ í¸ì§€ë¥¼ ë°›ì€ í›„ì›ìëŠ” ê¹Šì€ ê³ ë¯¼ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤. ìì‹ ì´ ì‚¬ë‘í•˜ëŠ” ì˜ˆìˆ ê°€ê°€ ë‹¤ë¥¸ ëˆ„êµ°ê°€ë¥¼(ì‹¤ì œë¡œëŠ” ìì‹ ì„) ì‚¬ë‘í•œë‹¤ê³  ê³ ë°±í•œ ê²ƒì…ë‹ˆë‹¤. ì´ì œ ìì‹ ì˜ ì •ì²´ë¥¼ ë°í ë•Œê°€ ì˜¨ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤..."
                }
            };
            
            document.getElementById('storyTitle').textContent = stories[storyNum].title;
            document.getElementById('storyContent').textContent = stories[storyNum].content;
        }

        function continueToNextLetter() {
            document.getElementById('storySection').style.display = 'none';
            document.getElementById('letterInterface').style.display = 'grid';
            loadLetter(gameState.currentLetter + 1);
        }

        function showEnding() {
            const finalScore = gameState.totalScore;
            let ending = '';
            
            if (finalScore >= 15) {
                ending = 'ì™„ë²½í•œ ì‚¬ë‘: ì„œë¡œì˜ ë§ˆìŒê³¼ ì •ì²´ë¥¼ í™•ì¸í•˜ê³  ì‚¬ë‘í•˜ê²Œ ë¨';
            } else if (finalScore >= 10) {
                ending = 'ë¹„í„°ìŠ¤ìœ„íŠ¸: ì„œë¡œì˜ ë§ˆìŒê³¼ ì •ì²´ëŠ” í™•ì¸í•˜ì§€ë§Œ ì‹ ë¶„ ì°¨ì´ë¥¼ ê·¹ë³µí•  ìš©ê¸°ë¥¼ ë‚´ì§€ ëª»í•¨';
            } else {
                ending = 'ë¯¸ì™„ì˜ ì‚¬ë‘: ì„œë¡œì˜ ì •ì²´ì™€ ë§ˆìŒì„ í™•ì¸í•˜ì§€ ëª»í•˜ê³  í›„ì›ìì™€ í”¼í›„ì›ìì˜ ê´€ê³„ë¡œ ë‚¨ê²Œë¨';
            }
            
            alert(`ê²Œì„ ì¢…ë£Œ!\n\n${gameState.character.name}ì˜ ì´ì•¼ê¸°\nì´ì : ${finalScore}ì \n\nê²°ë§: ${ending}`);
        }
    </script>
</body>
</html>