<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì„¯ ë²ˆì˜ í¸ì§€ì™€ í•˜ë‚˜ì˜ ë‹µì¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: #ffffff;
            color: #000000;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 40px;
            background: #f8f8f8;
            padding: 30px;
            border: 2px solid #333333;
        }

        .game-title {
            font-size: 2.5em;
            color: #000000;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: -1px;
        }

        .game-subtitle {
            font-size: 1.2em;
            color: #666666;
            font-style: italic;
            font-weight: 300;
        }

        /* ìºë¦­í„° ë©”ì´í‚¹ */
        .character-creation {
            background: #f5f5f5;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #cccccc;
        }

        .section-title {
            font-size: 1.8em;
            color: #000000;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid #cccccc;
            padding-bottom: 15px;
            font-weight: 300;
        }

        .character-form {
            display: grid;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #ffffff;
            padding: 15px 20px;
            border: 1px solid #dddddd;
            transition: all 0.3s ease;
        }

        .form-group:hover {
            background: #f9f9f9;
            border-color: #aaaaaa;
        }

        .form-label {
            font-weight: 500;
            color: #000000;
            min-width: 80px;
        }

        .form-input, .form-select {
            background: #ffffff;
            border: 1px solid #cccccc;
            padding: 10px 15px;
            color: #000000;
            min-width: 200px;
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #000000;
            background: #ffffff;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
        }

        .abilities-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .ability-item {
            text-align: center;
            background: #ffffff;
            padding: 15px;
            border: 1px solid #dddddd;
            transition: all 0.3s ease;
        }

        .ability-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ability-name {
            font-weight: 500;
            color: #000000;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .ability-value {
            font-size: 1.2em;
            font-weight: 600;
        }

        .ability-good { color: #228B22; }
        .ability-normal { color: #DAA520; }
        .ability-bad { color: #DC143C; }

        /* ê²Œì„ ì¸í„°í˜ì´ìŠ¤ */
        .game-interface {
            display: none;
            grid-template-columns: 400px 1fr;
            gap: 30px;
        }

        .game-sidebar {
            background: #f5f5f5;
            padding: 25px;
            height: fit-content;
            border: 1px solid #cccccc;
        }

        .game-main {
            background: #f5f5f5;
            padding: 30px;
            border: 1px solid #cccccc;
        }

        .paragraph-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .paragraph-number {
            font-size: 1.8em;
            color: #000000;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .current-step {
            font-size: 1.1em;
            color: #333333;
            background: #e0e0e0;
            padding: 10px 20px;
            display: inline-block;
        }

        /* ì‰í¬ë³‘ ìŠ¤íƒ€ì¼ */
        .inkwell {
            background: #eeeeee;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #cccccc;
        }

        .inkwell-title {
            color: #000000;
            font-weight: 500;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .word-pairs {
            display: grid;
            gap: 12px;
        }

        .word-pair {
            background: #ffffff;
            padding: 15px;
            border: 1px solid #dddddd;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .word-pair:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .word-pair.selected {
            background: #e6e6e6;
            border-color: #000000;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .word-pair.used {
            opacity: 0.4;
            pointer-events: none;
            background: #f9f9f9;
        }

        .passive-word {
            color: #999999;
            font-style: italic;
            font-size: 0.9em;
        }

        .active-word {
            color: #000000;
            font-weight: 600;
            font-size: 1em;
            margin-top: 5px;
        }

        /* íŒì • ì„¹ì…˜ */
        .judgement-section {
            background: #eeeeee;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #cccccc;
        }

        .judgement-title {
            color: #000000;
            font-weight: 500;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid #cccccc;
            padding-bottom: 10px;
        }

        .dice-section {
            text-align: center;
        }

        .dice-info {
            color: #333333;
            margin-bottom: 12px;
            font-size: 0.9em;
        }

        .dice-btn {
            background: #ffffff;
            color: #000000;
            border: 1px solid #cccccc;
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
        }

        .dice-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .dice-btn:disabled {
            background: #f9f9f9;
            cursor: not-allowed;
            transform: none;
            opacity: 0.5;
        }

        .dice-result {
            font-size: 0.85em;
            color: #000000;
            min-height: 25px;
            padding: 5px;
        }

        .dice-success {
            color: #228B22;
            font-weight: 600;
        }

        .dice-failure {
            color: #DC143C;
            font-weight: 600;
        }

        /* í¸ì§€ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .letter-container {
            background: #ffffff;
            color: #000000;
            padding: 40px;
            margin-bottom: 25px;
            font-family: 'Georgia', serif;
            font-size: 1.1em;
            line-height: 1.8;
            min-height: 600px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            border: 2px solid #cccccc;
        }

        .letter-paragraph {
            margin-bottom: 25px;
            padding: 15px;
            min-height: 120px;
            transition: all 0.3s ease;
            position: relative;
        }

        .letter-paragraph.completed {
            background: rgba(230,230,230,0.3);
            border-left: 4px solid #228B22;
        }

        .letter-paragraph.current {
            background: rgba(255,255,255,0.8);
            border: 2px dashed #666666;
            border-left: 4px solid #DAA520;
        }

        .letter-paragraph.pending {
            background: rgba(200,200,200,0.2);
            border-left: 4px solid #999999;
            opacity: 0.5;
        }

        .paragraph-label {
            font-size: 0.85em;
            color: #666666;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .paragraph-content {
            color: #000000;
            line-height: 1.8;
        }

        .current-editor {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            font-family: 'Georgia', serif;
            font-size: 1.1em;
            line-height: 1.8;
            color: #000000;
            resize: none;
            min-height: 100px;
            overflow: hidden;
        }

        .current-editor::placeholder {
            color: #888888;
            font-style: italic;
        }

        .paragraph-used-word {
            position: absolute;
            top: -8px;
            right: 10px;
            background: #000000;
            color: #ffffff;
            padding: 4px 8px;
            font-size: 0.7em;
            font-weight: 500;
        }

        .letter-signature {
            margin-top: 40px;
            text-align: right;
            font-style: italic;
            color: #666666;
        }

        .score-display {
            background: #eeeeee;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #cccccc;
        }

        .score-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            display: block;
            color: #333333;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .score-value {
            display: block;
            color: #000000;
            font-size: 1.6em;
            font-weight: 600;
        }

        .action-buttons {
            text-align: center;
            margin-top: 25px;
        }

        .btn {
            background: #ffffff;
            color: #000000;
            border: 1px solid #cccccc;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #f9f9f9;
            cursor: not-allowed;
            transform: none;
            opacity: 0.5;
        }

        .story-section {
            background: #f5f5f5;
            padding: 30px;
            margin: 20px 0;
            border-left: 4px solid #000000;
            display: none;
            border: 1px solid #cccccc;
        }

        .story-title {
            color: #000000;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 300;
        }

        .story-content {
            font-size: 1.1em;
            line-height: 1.8;
            text-align: justify;
            color: #000000;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 6px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #666666, #999999);
            height: 100%;
            transition: width 0.3s ease;
        }

        @media (max-width: 1024px) {
            .game-interface {
                grid-template-columns: 1fr;
            }
            
            .game-sidebar {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .game-title {
                font-size: 2em;
            }
            
            .abilities-display {
                grid-template-columns: 1fr;
            }
            
            .score-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">ë‹¤ì„¯ ë²ˆì˜ í¸ì§€ì™€ í•˜ë‚˜ì˜ ë‹µì¥</h1>
            <p class="game-subtitle">ìµëª…ì˜ í›„ì›ìì—ê²Œ ë³´ë‚´ëŠ” ì‚¬ë‘ì˜ í¸ì§€</p>
        </div>

        <!-- ì‹œë‚˜ë¦¬ì˜¤ ì†Œê°œ -->
        <div class="character-creation" id="scenarioIntro">
            <h2 class="section-title">ì‹œë‚˜ë¦¬ì˜¤ ì†Œê°œ</h2>
            <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.1);">
                <p style="margin-bottom: 15px;">ê¸´ ë¬´ëª… ìƒí™œì— ì§€ì³ê°€ë˜ ì–´ëŠ ë‚ , ì´ë¦„ë„ ì–¼êµ´ë„ ëª¨ë¥´ëŠ” ìµëª…ì˜ í›„ì›ìë¡œë¶€í„° í›„ì›ê¸ˆì„ ë°›ê²Œ ëœë‹¤.</p>
                <p style="margin-bottom: 15px;">ê·¸ëŠ” í•œë§ˆë”” ë§ë„ ì—†ì´ ìì‹ ì˜ ì‚¬ìš©ì¸ì„ í†µí•´ í›„ì›ê¸ˆì„ ì „ë‹¬í•  ë¿, ê·¸ ì–´ë–¤ ì‹ ìƒ ì •ë³´ë„ ì•Œë ¤ì£¼ì§€ ì•ŠëŠ”ë‹¤.</p>
                <p>ì–´ëŠ ë‚ , ì£¼ì¸ê³µì€ ë¬¸ë“ ê·¸ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ ë– ì˜¬ë¼ íœì„ ë“¤ì–´ í¸ì§€ë¥¼ ì“°ê¸° ì‹œì‘í•œë‹¤.</p>
            </div>
            <div class="action-buttons">
                <button class="btn" onclick="showCharacterCreation()">ìºë¦­í„° ë§Œë“¤ê¸°</button>
            </div>
        </div>

        <!-- ìºë¦­í„° ë©”ì´í‚¹ -->
        <div class="character-creation" id="characterCreation" style="display: none;">
            <h2 class="section-title">ìºë¦­í„° ë©”ì´í‚¹</h2>
            <div class="character-form">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="characterName" placeholder="ì˜ˆìˆ ê°€ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ì§ì—…</label>
                    <select class="form-select" id="characterProfession" onchange="updateAbilities()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="writer">ì‘ê°€</option>
                        <option value="painter">í™”ê°€</option>
                        <option value="musician">ìŒì•…ê°€</option>
                    </select>
                </div>

                <div class="abilities-display">
                    <div class="ability-item">
                        <div class="ability-name">ê°ì •</div>
                        <div class="ability-value" id="emotion">-</div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-name">ë¬¸ì¥ë ¥</div>
                        <div class="ability-value" id="language">-</div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-name">í•„ì²´</div>
                        <div class="ability-value" id="penmanship">-</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ê¸°ìˆ </label>
                    <select class="form-select" id="characterSkill">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="inspiration">ì˜ê° (ë¬¸ì¥ë ¥ íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                        <option value="elegance">í™”ë ¤í•¨ (í•„ì²´ íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                        <option value="passion">ë¶€í‘¼ ê°ì • (ê°ì • íŒì •ì— ì£¼ì‚¬ìœ„ +1)</option>
                    </select>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" id="startGameBtn" onclick="startGame()" disabled>ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <!-- ê²Œì„ ì¸í„°í˜ì´ìŠ¤ -->
        <div class="game-interface" id="gameInterface">
            <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
            <div class="game-sidebar">
                <!-- ì§„í–‰ ìƒí™© -->
                <div class="paragraph-header">
                    <div class="paragraph-number" id="paragraphNumber">1ë¬¸ë‹¨</div>
                    <div class="current-step" id="currentStep">ë‹¨ì–´ ì„ íƒ</div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                </div>

                <!-- ì‰í¬ë³‘ -->
                <div class="inkwell">
                    <div class="inkwell-title">ğŸ–‹ï¸ ì‰í¬ë³‘</div>
                    <div class="word-pairs" id="inkwell">
                        <!-- ë‹¨ì–´ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- ë¯¸ì‚¬ì—¬êµ¬ íŒì • -->
                <div class="judgement-section" id="emotionJudgement" style="display: none;">
                    <div class="judgement-title">ğŸ­ ë¯¸ì‚¬ì—¬êµ¬ íŒì • (ì„ íƒ)</div>
                    <div class="dice-section">
                        <div class="dice-info">ê°ì • <span id="emotionDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„</div>
                        <button class="dice-btn" id="emotionRollBtn" onclick="rollEmotion()">ê°ì • íŒì •í•˜ê¸°</button>
                        <div class="dice-result" id="emotionResult"></div>
                    </div>
                </div>

                <!-- ë¬¸ì¥ë ¥ íŒì • -->
                <div class="judgement-section" id="languageJudgement" style="display: none;">
                    <div class="judgement-title">ğŸ“ ë¬¸ì¥ë ¥ íŒì • (í•„ìˆ˜)</div>
                    <div class="dice-section">
                        <div class="dice-info">ë¬¸ì¥ë ¥ <span id="languageDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„</div>
                        <button class="dice-btn" id="languageRollBtn" onclick="rollLanguage()">ë¬¸ì¥ë ¥ íŒì •í•˜ê¸°</button>
                        <div class="dice-result" id="languageResult"></div>
                    </div>
                </div>

                <!-- í•„ì²´ íŒì • -->
                <div class="judgement-section" id="penmanshipJudgement" style="display: none;">
                    <div class="judgement-title">âœ’ï¸ í•„ì²´ íŒì • (í•„ìˆ˜)</div>
                    <div class="dice-section">
                        <div class="dice-info">í•„ì²´ <span id="penmanshipDiceCount">2</span>ê°œ ì£¼ì‚¬ìœ„</div>
                        <button class="dice-btn" id="penmanshipRollBtn" onclick="rollPenmanship()">í•„ì²´ íŒì •í•˜ê¸°</button>
                        <div class="dice-result" id="penmanshipResult"></div>
                    </div>
                </div>

                <!-- ê¸°ìˆ  ì‚¬ìš© -->
                <div class="judgement-section" id="skillSection">
                    <div class="judgement-title">âš¡ ê¸°ìˆ </div>
                    <div style="text-align: center;">
                        <div style="color: #cccccc; margin-bottom: 10px;">
                            <span id="skillName">ë¯¸ì„ íƒ</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="skillCheckbox" style="width: 16px; height: 16px;" />
                                <span style="color: #cccccc; font-size: 0.9em;">ì´ë²ˆ íŒì •ì— ê¸°ìˆ  ì‚¬ìš©</span>
                            </label>
                        </div>
                        <div style="font-size: 0.8em; color: #999;">
                            <span id="skillStatus">ì‚¬ìš© ê°€ëŠ¥</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìš°ì¸¡ ë©”ì¸ -->
            <div class="game-main">
                <!-- í¸ì§€ í—¤ë” -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 1.4em; color: #ffffff; margin-bottom: 10px;">
                        ìµëª…ì˜ í›„ì›ìë‹˜ê»˜
                    </div>
                    <div style="color: #cccccc; font-size: 0.9em;">
                        <span id="letterProgress">1ë¬¸ë‹¨ ì‘ì„± ì¤‘</span>
                    </div>
                </div>

                <!-- ì „ì²´ í¸ì§€ ë·° -->
                <div class="letter-container" id="letterContainer">
                    <!-- í¸ì§€ ë¬¸ë‹¨ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <!-- í˜„ì¬ ë¬¸ë‹¨ ì •ë³´ -->
                <div id="paragraphInfo" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; display: none;">
                    <div style="color: #ffffff; font-weight: 500; margin-bottom: 10px;">í˜„ì¬ ë¬¸ë‹¨ ì •ë³´:</div>
                    <div style="color: #cccccc; font-size: 0.9em;">
                        <div>ì„ íƒëœ ë‹¨ì–´: <span id="selectedWord">-</span></div>
                        <div>ë¯¸ì‚¬ì—¬êµ¬: <span id="emotionStatus">íŒì • ì•ˆí•¨</span></div>
                        <div>ë¬¸ì¥ë ¥: <span id="languageStatus">íŒì • ì•ˆí•¨</span></div>
                        <div>ë‹¨ì–´ ì¢…ë¥˜: <span id="wordType">-</span></div>
                    </div>
                </div>

                <div class="score-display">
                    <div class="score-row">
                        <div class="score-item">
                            <span class="score-label">ë¬¸ë‹¨ ì ìˆ˜</span>
                            <span class="score-value" id="paragraphScore">0</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">ì´ ì ìˆ˜</span>
                            <span class="score-value" id="totalScore">0</span>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" id="selectWordBtn" onclick="proceedToEmotion()" disabled>ë‹¨ì–´ ì„ íƒ ì™„ë£Œ</button>
                    <button class="btn" id="skipEmotionBtn" onclick="proceedToLanguage()" disabled style="display: none;">ë¯¸ì‚¬ì—¬êµ¬ ê±´ë„ˆë›°ê¸°</button>
                    <button class="btn" id="writeBtn" onclick="proceedToWriting()" disabled style="display: none;">ê¸€ì“°ê¸° ì‹œì‘</button>
                    <button class="btn" id="nextParagraphBtn" onclick="nextParagraph()" disabled style="display: none;">ë‹¤ìŒ ë¬¸ë‹¨</button>
                    <button class="btn" id="finishLetterBtn" onclick="finishLetter()" disabled style="display: none;">í¸ì§€ ì™„ì„±</button>
                </div>
            </div>
        </div>

        <!-- ìŠ¤í† ë¦¬ ì„¹ì…˜ -->
        <div class="story-section" id="storySection">
            <div class="story-title" id="storyTitle">ì²« ë²ˆì§¸ ë§Œë‚¨</div>
            <div class="story-content" id="storyContent">
                <!-- ìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="action-buttons">
                <button class="btn" onclick="continueToNextLetter()">ë‹¤ìŒ í¸ì§€ ì“°ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            character: {
                name: '',
                profession: '',
                abilities: {emotion: 0, language: 0, penmanship: 0},
                skill: ''
            },
            currentLetter: 1,
            currentParagraph: 1,
            paragraphData: {
                selectedWord: null,
                selectedPair: null,
                emotionRoll: null,
                languageRoll: null,
                penmanshipRoll: null,
                paragraphText: '',
                score: 0
            },
            totalScore: 0,
            letterScores: [],
            skillUsed: false,
            usedWords: [],
            completedParagraphs: []
        };

        const professionData = {
            writer: {emotion: 1, language: 3, penmanship: 2},    // ë‚˜ì¨/ì¢‹ìŒ/ë³´í†µ
            painter: {emotion: 2, language: 1, penmanship: 3},   // ë³´í†µ/ë‚˜ì¨/ì¢‹ìŒ
            musician: {emotion: 3, language: 2, penmanship: 1}   // ì¢‹ìŒ/ë³´í†µ/ë‚˜ì¨
        };

        const letterPrompts = {
            1: "ì²« ë²ˆì§¸ í¸ì§€: ìµëª…ì˜ í›„ì›ìì—ê²Œ ê°ì‚¬ì˜ ë§ˆìŒì„ ì „í•˜ì„¸ìš”.",
            2: "ë‘ ë²ˆì§¸ í¸ì§€: ì˜¤ëŠ˜ ë§Œë‚œ í¥ë¯¸ë¡œìš´ ë¶„ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ì„¸ìš”.",
            3: "ì„¸ ë²ˆì§¸ í¸ì§€: ê·¸ë¶„ê³¼ì˜ ë‘ ë²ˆì§¸ ë§Œë‚¨ì„ ì„¤ëª…í•˜ì„¸ìš”.",
            4: "ë„¤ ë²ˆì§¸ í¸ì§€: ì‚¬ë‘ì— ë¹ ì§„ ë§ˆìŒì„ ê³ ë°±í•˜ì„¸ìš”.",
            5: "ë‹¤ì„¯ ë²ˆì§¸ í¸ì§€: ë§ˆì§€ë§‰ í¸ì§€ë¥¼ ì¨ë³´ì„¸ìš”."
        };

        const inkwells = {
            1: [
                {passive: "ê·¸ë¦¼", active: "ì˜í˜¼ì„ ë‹´ì€ ìº”ë²„ìŠ¤"},
                {passive: "ëˆ", active: "ì†Œì¤‘í•œ í›„ì›"},
                {passive: "ì‘ì—…ì‹¤", active: "ì°½ì‘ì˜ ì„±ì†Œ"},
                {passive: "ë¶“", active: "ë§ˆìŒì„ ê·¸ë¦¬ëŠ” ë¶“"},
                {passive: "ê°ì‚¬", active: "ê¹Šì€ ê°ëª…"},
                {passive: "ë¯¸ë˜", active: "ì°¬ë€í•œ ì „ë§"}
            ],
            2: [
                {passive: "ì‚¬ëŒ", active: "ì‹ ë¹„ë¡œìš´ ë¶„"},
                {passive: "ë§Œë‚¨", active: "ìš´ëª…ì  ì¡°ìš°"},
                {passive: "ëŒ€í™”", active: "ë§ˆìŒ ê¹Šì€ ëŒ€í™”"},
                {passive: "ëˆˆ", active: "ë³„ë¹› ê°™ì€ ëˆˆë™ì"},
                {passive: "ì›ƒìŒ", active: "ì€ì€í•œ ë¯¸ì†Œ"},
                {passive: "ì‹œê°„", active: "í™©í™€í•œ ì‹œê°„"}
            ],
            3: [
                {passive: "ë˜", active: "ë‹¤ì‹œê¸ˆ"},
                {passive: "ë§ˆìŒ", active: "ë–¨ë¦¬ëŠ” ê°€ìŠ´"},
                {passive: "ìƒê°", active: "ê·¸ë¦¬ìš´ ë§ˆìŒ"},
                {passive: "ë°¤", active: "ì  ëª» ë“œëŠ” ë°¤"},
                {passive: "ê¿ˆ", active: "ë‹¬ì½¤í•œ ê¿ˆ"},
                {passive: "ê¸°ë‹¤ë¦¼", active: "ê°„ì ˆí•œ ê¸°ë‹¤ë¦¼"}
            ],
            4: [
                {passive: "ì‚¬ë‘", active: "ê¹Šì€ ì‚¬ë‘"},
                {passive: "ë§ˆìŒ", active: "ë¶ˆíƒ€ëŠ” ë§ˆìŒ"},
                {passive: "ê³ ë°±", active: "ì§„ì‹¬ ì–´ë¦° ê³ ë°±"},
                {passive: "ê°ì •", active: "íƒ€ì˜¤ë¥´ëŠ” ê°ì •"},
                {passive: "ì›í•¨", active: "ê°„ì ˆí•œ ë°”ëŒ"},
                {passive: "í•¨ê»˜", active: "ì˜ì›íˆ í•¨ê»˜"}
            ],
            5: [
                {passive: "ë", active: "ìƒˆë¡œìš´ ì‹œì‘"},
                {passive: "ê°ì‚¬", active: "ë¬´í•œí•œ ê°ì‚¬"},
                {passive: "ê¸°ì–µ", active: "ì†Œì¤‘í•œ ê¸°ì–µ"},
                {passive: "ì•ìœ¼ë¡œ", active: "ì°¬ë€í•œ ë¯¸ë˜"},
                {passive: "ë§ˆìŒ", active: "ë³€ì¹˜ ì•ŠëŠ” ë§ˆìŒ"},
                {passive: "í¸ì§€", active: "ë§ˆì§€ë§‰ í¸ì§€"}
            ]
        };

        // ìºë¦­í„° ìƒì„± ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showCharacterCreation() {
            document.getElementById('scenarioIntro').style.display = 'none';
            document.getElementById('characterCreation').style.display = 'block';
        }

        function updateAbilities() {
            const profession = document.getElementById('characterProfession').value;
            if (!profession) return;

            const abilities = professionData[profession];
            const abilityNames = ['ë‚˜ì¨', 'ë³´í†µ', 'ì¢‹ìŒ'];
            const abilityClasses = ['ability-bad', 'ability-normal', 'ability-good'];

            document.getElementById('emotion').textContent = abilityNames[abilities.emotion - 1];
            document.getElementById('emotion').className = abilityClasses[abilities.emotion - 1];

            document.getElementById('language').textContent = abilityNames[abilities.language - 1];
            document.getElementById('language').className = abilityClasses[abilities.language - 1];

            document.getElementById('penmanship').textContent = abilityNames[abilities.penmanship - 1];
            document.getElementById('penmanship').className = abilityClasses[abilities.penmanship - 1];

            checkFormComplete();
        }

        function checkFormComplete() {
            const name = document.getElementById('characterName').value.trim();
            const profession = document.getElementById('characterProfession').value;
            const skill = document.getElementById('characterSkill').value;

            document.getElementById('startGameBtn').disabled = !(name && profession && skill);
        }

        document.getElementById('characterName').addEventListener('input', checkFormComplete);
        document.getElementById('characterSkill').addEventListener('change', checkFormComplete);

        function startGame() {
            // ìºë¦­í„° ì •ë³´ ì €ì¥
            gameState.character.name = document.getElementById('characterName').value.trim();
            gameState.character.profession = document.getElementById('characterProfession').value;
            gameState.character.abilities = professionData[gameState.character.profession];
            gameState.character.skill = document.getElementById('characterSkill').value;

            // í™”ë©´ ì „í™˜
            document.getElementById('characterCreation').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'grid';

            // ì²« ë²ˆì§¸ í¸ì§€ ì‹œì‘
            startLetter(1);
        }

        // í¸ì§€ ì‹œì‘
        function startLetter(letterNum) {
            gameState.currentLetter = letterNum;
            gameState.currentParagraph = 1;
            gameState.usedWords = [];
            gameState.completedParagraphs = [];
            // ìƒˆ í¸ì§€ ì‹œì‘ ì‹œì—ë§Œ ê¸°ìˆ  ì´ˆê¸°í™” (ê°™ì€ í¸ì§€ ë‚´ì—ì„œëŠ” ìœ ì§€)
            if (letterNum === 1) {
                gameState.skillUsed = false;
            }
            
            updateUI();
            loadInkwell();
            
            // ê¸°ìˆ  ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            if (!gameState.skillUsed) {
                document.getElementById('skillCheckbox').checked = false;
                document.getElementById('skillCheckbox').disabled = false;
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const paragraphNumbers = ['', '1ë¬¸ë‹¨', '2ë¬¸ë‹¨', '3ë¬¸ë‹¨', '4ë¬¸ë‹¨', '5ë¬¸ë‹¨'];
            document.getElementById('paragraphNumber').textContent = paragraphNumbers[gameState.currentParagraph] || 'ì™„ì„±';
            document.getElementById('currentStep').textContent = gameState.currentParagraph > 5 ? 'í¸ì§€ ì™„ì„±' : 'ë‹¨ì–´ ì„ íƒ';
            
            if (gameState.currentParagraph > 5) {
                document.getElementById('letterProgress').textContent = 'í¸ì§€ ì™„ì„± (5/5)';
            } else {
                document.getElementById('letterProgress').textContent = 
                    `${gameState.currentParagraph}ë¬¸ë‹¨ ì‘ì„± ì¤‘ (${gameState.currentParagraph}/5)`;
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = gameState.currentParagraph > 5 ? 100 : (gameState.currentParagraph - 1) * 20 + 20;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // ëŠ¥ë ¥ì¹˜ í‘œì‹œ
            const abilities = gameState.character.abilities;
            document.getElementById('emotionDiceCount').textContent = abilities.emotion;
            document.getElementById('languageDiceCount').textContent = abilities.language;
            document.getElementById('penmanshipDiceCount').textContent = abilities.penmanship;
            
            // ê¸°ìˆ  ì •ë³´
            const skillNames = {
                inspiration: 'ì˜ê°',
                elegance: 'í™”ë ¤í•¨',
                passion: 'ë¶€í‘¼ ê°ì •'
            };
            document.getElementById('skillName').textContent = skillNames[gameState.character.skill] || 'ë¯¸ì„ íƒ';
            document.getElementById('skillStatus').textContent = gameState.skillUsed ? 'ì‚¬ìš©ë¨' : 'ì‚¬ìš© ê°€ëŠ¥';
            
            // í¸ì§€ ì „ì²´ ì—…ë°ì´íŠ¸
            updateLetterContainer();
            
            // ì™„ì„± ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ ë¦¬ì…‹
            if (gameState.currentParagraph <= 5) {
                resetParagraphState();
            }
        }

        // í¸ì§€ ì»¨í…Œì´ë„ˆ ì—…ë°ì´íŠ¸
        function updateLetterContainer() {
            const container = document.getElementById('letterContainer');
            container.innerHTML = '';
            
            // í¸ì§€ ì‹œì‘ ì¸ì‚¬ë§
            const greeting = document.createElement('div');
            greeting.style.cssText = 'margin-bottom: 30px; font-style: italic; color: #666;';
            greeting.textContent = 'ì¹œì• í•˜ëŠ” í›„ì›ìë‹˜ê»˜,';
            container.appendChild(greeting);
            
            // 5ê°œ ë¬¸ë‹¨ ìƒì„±
            for (let i = 1; i <= 5; i++) {
                const paragraphDiv = document.createElement('div');
                paragraphDiv.className = 'letter-paragraph';
                paragraphDiv.id = `paragraph-${i}`;
                
                // ë¬¸ë‹¨ ë¼ë²¨
                const label = document.createElement('div');
                label.className = 'paragraph-label';
                label.textContent = `${i}ë¬¸ë‹¨`;
                
                // ë¬¸ë‹¨ ë‚´ìš© ì»¨í…Œì´ë„ˆ
                const content = document.createElement('div');
                content.className = 'paragraph-content';
                
                if (i < gameState.currentParagraph || gameState.currentParagraph > 5) {
                    // ì™„ì„±ëœ ë¬¸ë‹¨ (ë˜ëŠ” í¸ì§€ ì™„ì„± í›„)
                    paragraphDiv.classList.add('completed');
                    const completedParagraph = gameState.completedParagraphs[i - 1];
                    if (completedParagraph) {
                        content.textContent = completedParagraph.paragraphText;
                        
                        // ì‚¬ìš©ëœ ë‹¨ì–´ í‘œì‹œ
                        const usedWord = document.createElement('div');
                        usedWord.className = 'paragraph-used-word';
                        const pair = completedParagraph.selectedPair;
                        const wordUsed = completedParagraph.languageRoll ? pair.active : pair.passive;
                        usedWord.textContent = wordUsed;
                        paragraphDiv.appendChild(usedWord);
                    }
                    
                } else if (i === gameState.currentParagraph) {
                    // í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë¬¸ë‹¨
                    paragraphDiv.classList.add('current');
                    
                    const editor = document.createElement('textarea');
                    editor.className = 'current-editor';
                    editor.id = 'currentParagraphEditor';
                    editor.placeholder = `${i}ë²ˆì§¸ ë¬¸ë‹¨ì„ ì‘ì„±í•˜ì„¸ìš”. ì„ íƒí•œ ë‹¨ì–´ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.`;
                    
                    // ìë™ ë†’ì´ ì¡°ì ˆ
                    editor.addEventListener('input', function() {
                        this.style.height = 'auto';
                        this.style.height = this.scrollHeight + 'px';
                    });
                    
                    content.appendChild(editor);
                    
                    // í¬ì»¤ìŠ¤ ë° ì´ˆê¸° ë†’ì´ ì„¤ì •
                    setTimeout(() => {
                        editor.focus();
                        editor.style.height = 'auto';
                        editor.style.height = editor.scrollHeight + 'px';
                    }, 100);
                    
                } else {
                    // ì•„ì§ ì‘ì„±í•˜ì§€ ì•Šì€ ë¬¸ë‹¨
                    paragraphDiv.classList.add('pending');
                    content.innerHTML = '<div style="color: #999; font-style: italic;">ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ ë¬¸ë‹¨ì…ë‹ˆë‹¤.</div>';
                }
                
                paragraphDiv.appendChild(label);
                paragraphDiv.appendChild(content);
                container.appendChild(paragraphDiv);
            }
            
            // í¸ì§€ ë§ˆë¬´ë¦¬
            const signature = document.createElement('div');
            signature.className = 'letter-signature';
            signature.innerHTML = `
                <div style="margin-bottom: 10px;">ë‹¹ì‹ ì˜ ì˜ˆìˆ ê°€,</div>
                <div><strong>${gameState.character.name || 'ìµëª…ì˜ ì˜ˆìˆ ê°€'}</strong></div>
            `;
            container.appendChild(signature);
        }

        function resetParagraphState() {
            gameState.paragraphData = {
                selectedWord: null,
                selectedPair: null,
                emotionRoll: null,
                languageRoll: null,
                penmanshipRoll: null,
                paragraphText: '',
                score: 0
            };
            
            // íŒì • ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('emotionJudgement').style.display = 'none';
            document.getElementById('languageJudgement').style.display = 'none';
            document.getElementById('penmanshipJudgement').style.display = 'none';
            document.getElementById('paragraphInfo').style.display = 'none';
            
            // ë²„íŠ¼ ìƒíƒœ ë¦¬ì…‹
            document.getElementById('selectWordBtn').disabled = true;
            document.getElementById('selectWordBtn').style.display = 'inline-block'; // ë‹¤ì‹œ ë³´ì´ê²Œ
            document.getElementById('skipEmotionBtn').style.display = 'none';
            document.getElementById('writeBtn').style.display = 'none';
            document.getElementById('nextParagraphBtn').style.display = 'none';
            document.getElementById('finishLetterBtn').style.display = 'none';
            
            // ì£¼ì‚¬ìœ„ ë²„íŠ¼ ë¦¬ì…‹
            document.getElementById('emotionRollBtn').disabled = false;
            document.getElementById('languageRollBtn').disabled = false;
            document.getElementById('penmanshipRollBtn').disabled = false;
            
            // ê²°ê³¼ ì´ˆê¸°í™”
            document.getElementById('emotionResult').textContent = '';
            document.getElementById('languageResult').textContent = '';
            document.getElementById('penmanshipResult').textContent = '';
            
            // ê¸°ìˆ  ì²´í¬ë°•ìŠ¤ ë¦¬ì…‹ (ê¸°ìˆ ì´ ì´ë¯¸ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ)
            if (!gameState.skillUsed) {
                document.getElementById('skillCheckbox').checked = false;
                document.getElementById('skillCheckbox').disabled = false;
            }
        }

        // ì‰í¬ë³‘ ë¡œë“œ
        function loadInkwell() {
            const inkwellEl = document.getElementById('inkwell');
            inkwellEl.innerHTML = '';
            
            inkwells[gameState.currentLetter].forEach((pair, index) => {
                const pairEl = document.createElement('div');
                pairEl.className = 'word-pair';
                pairEl.dataset.index = index;
                
                // ì‚¬ìš©ëœ ë‹¨ì–´ ì²´í¬
                if (gameState.usedWords.includes(index)) {
                    pairEl.classList.add('used');
                }
                
                pairEl.innerHTML = `
                    <div class="passive-word">${pair.passive}</div>
                    <div class="active-word">${pair.active}</div>
                `;
                
                if (!gameState.usedWords.includes(index)) {
                    pairEl.addEventListener('click', function() {
                        selectWord(index, pair);
                    });
                }
                
                inkwellEl.appendChild(pairEl);
            });
        }

        // ë‹¨ì–´ ì„ íƒ
        function selectWord(index, pair) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            document.querySelectorAll('.word-pair').forEach(el => el.classList.remove('selected'));
            
            // ìƒˆë¡œìš´ ì„ íƒ
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            
            gameState.paragraphData.selectedWord = index;
            gameState.paragraphData.selectedPair = pair;
            
            document.getElementById('selectWordBtn').disabled = false;
            
            console.log('ì„ íƒëœ ë‹¨ì–´:', pair); // ë””ë²„ê¹…ìš©
        }

        // ë¯¸ì‚¬ì—¬êµ¬ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToEmotion() {
            document.getElementById('currentStep').textContent = 'ë¯¸ì‚¬ì—¬êµ¬ íŒì •';
            document.getElementById('emotionJudgement').style.display = 'block';
            document.getElementById('selectWordBtn').style.display = 'none';
            document.getElementById('skipEmotionBtn').style.display = 'inline-block';
            document.getElementById('skipEmotionBtn').disabled = false;
            
            updateParagraphInfo();
        }

        // ë¬¸ì¥ë ¥ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToLanguage() {
            document.getElementById('currentStep').textContent = 'ë¬¸ì¥ë ¥ íŒì •';
            document.getElementById('languageJudgement').style.display = 'block';
            document.getElementById('skipEmotionBtn').style.display = 'none';
            document.getElementById('emotionJudgement').style.display = 'none';
        }

        // ê¸€ì“°ê¸° ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToWriting() {
            document.getElementById('currentStep').textContent = 'ë¬¸ë‹¨ ì‘ì„±';
            document.getElementById('languageJudgement').style.display = 'none';
            document.getElementById('penmanshipJudgement').style.display = 'block';
            document.getElementById('writeBtn').style.display = 'none';
            
            // ì‚¬ìš©í•  ë‹¨ì–´ ê²°ì •
            const pair = gameState.paragraphData.selectedPair;
            const useActiveWord = gameState.paragraphData.languageRoll;
            const wordToUse = useActiveWord ? pair.active : pair.passive;
            
            // í˜„ì¬ í¸ì§‘ê¸°ì˜ placeholder ì—…ë°ì´íŠ¸
            const editor = document.getElementById('currentParagraphEditor');
            if (editor) {
                editor.placeholder = `ì´ ë¬¸ë‹¨ì—ì„œ "${wordToUse}" ë‹¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸€ì„ ì¨ë³´ì„¸ìš”...`;
                editor.focus();
            }
                
            updateParagraphInfo();
        }

        // ë¬¸ë‹¨ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateParagraphInfo() {
            const pair = gameState.paragraphData.selectedPair;
            if (!pair) return;
            
            document.getElementById('paragraphInfo').style.display = 'block';
            document.getElementById('selectedWord').textContent = 
                `${pair.passive} / ${pair.active}`;
            
            document.getElementById('emotionStatus').textContent = 
                gameState.paragraphData.emotionRoll === null ? 'íŒì • ì•ˆí•¨' :
                gameState.paragraphData.emotionRoll ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                
            document.getElementById('languageStatus').textContent = 
                gameState.paragraphData.languageRoll === null ? 'íŒì • ì•ˆí•¨' :
                gameState.paragraphData.languageRoll ? 'ì„±ê³µ (ê³ ìƒí•œ ë‹¨ì–´)' : 'ì‹¤íŒ¨ (ì²œë°•í•œ ë‹¨ì–´)';
                
            document.getElementById('wordType').textContent = 
                gameState.paragraphData.languageRoll === null ? '-' :
                gameState.paragraphData.languageRoll ? pair.active : pair.passive;
        }

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° í•¨ìˆ˜ë“¤
        function rollEmotion() {
            let diceCount = gameState.character.abilities.emotion;
            let skillUsed = false;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤
            if (document.getElementById('skillCheckbox').checked && !gameState.skillUsed && gameState.character.skill === 'passion') {
                diceCount += 1;
                skillUsed = true;
            }
            
            const result = rollDice(diceCount);
            gameState.paragraphData.emotionRoll = result.success;
            
            if (skillUsed) {
                gameState.skillUsed = true;
                document.getElementById('skillStatus').textContent = 'ì‚¬ìš©ë¨';
                document.getElementById('skillCheckbox').disabled = true;
            }
            
            document.getElementById('emotionResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ! (ë¯¸ì‚¬ì—¬êµ¬ ê°€ëŠ¥)' : 'ì‹¤íŒ¨'}</span>`;
            
            document.getElementById('emotionRollBtn').disabled = true;
            proceedToLanguage();
        }

        function rollLanguage() {
            let diceCount = gameState.character.abilities.language;
            let skillUsed = false;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤
            if (document.getElementById('skillCheckbox').checked && !gameState.skillUsed && gameState.character.skill === 'inspiration') {
                diceCount += 1;
                skillUsed = true;
            }
            
            const result = rollDice(diceCount);
            gameState.paragraphData.languageRoll = result.success;
            
            if (skillUsed) {
                gameState.skillUsed = true;
                document.getElementById('skillStatus').textContent = 'ì‚¬ìš©ë¨';
                document.getElementById('skillCheckbox').disabled = true;
            }
            
            const wordType = result.success ? 'ê³ ìƒí•œ ë‹¨ì–´' : 'ì²œë°•í•œ ë‹¨ì–´';
            document.getElementById('languageResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ!' : 'ì‹¤íŒ¨'} (${wordType})</span>`;
            
            document.getElementById('languageRollBtn').disabled = true;
            document.getElementById('writeBtn').style.display = 'inline-block';
            document.getElementById('writeBtn').disabled = false;
        }

        function rollPenmanship() {
            let diceCount = gameState.character.abilities.penmanship;
            let skillUsed = false;
            
            // ê¸°ìˆ  ë³´ë„ˆìŠ¤
            if (document.getElementById('skillCheckbox').checked && !gameState.skillUsed && gameState.character.skill === 'elegance') {
                diceCount += 1;
                skillUsed = true;
            }
            
            const result = rollDice(diceCount);
            gameState.paragraphData.penmanshipRoll = result.success;
            
            if (skillUsed) {
                gameState.skillUsed = true;
                document.getElementById('skillStatus').textContent = 'ì‚¬ìš©ë¨';
                document.getElementById('skillCheckbox').disabled = true;
            }
            
            document.getElementById('penmanshipResult').innerHTML = 
                `ì£¼ì‚¬ìœ„ ${diceCount}ê°œ: ${result.rolls.join(', ')}<br>` +
                `<span class="${result.success ? 'dice-success' : 'dice-failure'}">` +
                `${result.success ? 'ì„±ê³µ! (+1ì )' : 'ì‹¤íŒ¨'}</span>`;
            
            document.getElementById('penmanshipRollBtn').disabled = true;
            
            // ì ìˆ˜ ê³„ì‚°
            calculateParagraphScore();
            
            // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í™œì„±í™”
            if (gameState.currentParagraph < 5) {
                document.getElementById('nextParagraphBtn').style.display = 'inline-block';
                document.getElementById('nextParagraphBtn').disabled = false;
            } else {
                document.getElementById('finishLetterBtn').style.display = 'inline-block';
                document.getElementById('finishLetterBtn').disabled = false;
            }
        }

        function rollDice(count) {
            const rolls = [];
            let hasSuccess = false;
            
            for (let i = 0; i < count; i++) {
                const roll = Math.floor(Math.random() * 6) + 1;
                rolls.push(roll);
                if (roll >= 5) {
                    hasSuccess = true;
                }
            }
            
            return {
                rolls: rolls,
                success: hasSuccess
            };
        }

        // ë¬¸ë‹¨ ì ìˆ˜ ê³„ì‚°
        function calculateParagraphScore() {
            let score = 0;
            
            // ë‹¨ì–´ ì ìˆ˜
            if (gameState.paragraphData.languageRoll) {
                score += 1; // ê³ ìƒí•œ ë‹¨ì–´
                
                // ë¯¸ì‚¬ì—¬êµ¬ ë³´ë„ˆìŠ¤
                if (gameState.paragraphData.emotionRoll) {
                    score += 1; // ë¯¸ì‚¬ì—¬êµ¬ë¡œ ì´ 2ì 
                }
            } else {
                // ì²œë°•í•œ ë‹¨ì–´
                if (gameState.paragraphData.emotionRoll) {
                    score -= 1; // ë¯¸ì‚¬ì—¬êµ¬ íŒ¨ë„í‹°
                }
            }
            
            // í•„ì²´ ì ìˆ˜
            if (gameState.paragraphData.penmanshipRoll) {
                score += 1;
            }
            
            gameState.paragraphData.score = score;
            gameState.totalScore += score;
            
            document.getElementById('paragraphScore').textContent = score;
            document.getElementById('totalScore').textContent = gameState.totalScore;
        }

        // ë‹¤ìŒ ë¬¸ë‹¨ìœ¼ë¡œ
        function nextParagraph() {
            // í˜„ì¬ ë¬¸ë‹¨ í…ìŠ¤íŠ¸ ì €ì¥
            const editor = document.getElementById('currentParagraphEditor');
            gameState.paragraphData.paragraphText = editor ? editor.value : '';
            
            // í˜„ì¬ ë¬¸ë‹¨ ì €ì¥
            gameState.completedParagraphs.push({...gameState.paragraphData});
            gameState.usedWords.push(gameState.paragraphData.selectedWord);
            
            // ë‹¤ìŒ ë¬¸ë‹¨ìœ¼ë¡œ
            gameState.currentParagraph++;
            updateUI();
            loadInkwell();
        }

        // í¸ì§€ ì™„ì„±
        function finishLetter() {
            // ë§ˆì§€ë§‰ ë¬¸ë‹¨ í…ìŠ¤íŠ¸ ì €ì¥
            const editor = document.getElementById('currentParagraphEditor');
            gameState.paragraphData.paragraphText = editor ? editor.value : '';
            
            // ë§ˆì§€ë§‰ ë¬¸ë‹¨ ì €ì¥
            gameState.completedParagraphs.push({...gameState.paragraphData});
            gameState.usedWords.push(gameState.paragraphData.selectedWord);
            
            // í¸ì§€ ì™„ì„± í›„ í™”ë©´ ì—…ë°ì´íŠ¸
            gameState.currentParagraph = 6; // ì™„ì„± ìƒíƒœ
            updateLetterContainer();
            
            // ê²°ê³¼ í‘œì‹œ
            if (gameState.currentLetter < 4) {
                showStory(gameState.currentLetter);
            } else if (gameState.currentLetter === 4) {
                startLetter(5);
            } else {
                showEnding();
            }
        }

        // ìŠ¤í† ë¦¬ í‘œì‹œ
        function showStory(storyNum) {
            document.getElementById('gameInterface').style.display = 'none';
            document.getElementById('storySection').style.display = 'block';
            
            const stories = {
                1: {
                    title: "ì²« ë²ˆì§¸ ë§Œë‚¨",
                    content: "ë‹¹ì‹ ì´ í¸ì§€ë¥¼ ë³´ë‚¸ ë©°ì¹  í›„, ì‹œì¥ì—ì„œ ìš°ì—°íˆ í•œ ë¶„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ê·¸ë¶„ì€ ë‹¹ì‹ ì˜ ì‘í’ˆì— ëŒ€í•´ ë†€ë¼ìš´ ì§€ì‹ì„ ê°€ì§€ê³  ìˆì—ˆê³ , ì˜ˆìˆ ì— ëŒ€í•œ ê¹Šì€ ì´í•´ë¥¼ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ê·¸ë¶„ê³¼ì˜ ëŒ€í™”ì—ì„œ ë¬˜í•œ ì¹œë°€ê°ì„ ëŠê¼ˆìŠµë‹ˆë‹¤..."
                },
                2: {
                    title: "ë‘ ë²ˆì§¸ ë§Œë‚¨",
                    content: "ë©°ì¹  í›„, ë‹¹ì‹ ì€ ë‹¤ì‹œ ê·¸ë¶„ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ë” ì˜¤ëœ ì‹œê°„ í•¨ê»˜ ë³´ëƒˆê³ , ê·¸ë¶„ì˜ ë”°ëœ»í•œ ë§ˆìŒê³¼ ì§€í˜œë¡œìš´ ë§ì”€ì— ê¹Šì€ ê°ëª…ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. í˜¹ì‹œ ì´ë¶„ì´... í•˜ëŠ” ìƒê°ì´ ìŠ¤ì³¤ì§€ë§Œ, ì„¤ë§ˆ í•˜ë©° ê³ ê°œë¥¼ ì €ì—ˆìŠµë‹ˆë‹¤..."
                },
                3: {
                    title: "ê¹¨ë‹¬ìŒì˜ ìˆœê°„",
                    content: "ë‹¹ì‹ ì˜ ë§ˆìŒì€ ì´ë¯¸ ê·¸ë¶„ì—ê²Œ í–¥í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë°¤ë§ˆë‹¤ ê·¸ë¶„ì„ ë– ì˜¬ë¦¬ë©° ì ë“¤ì—ˆê³ , ì•„ì¹¨ë§ˆë‹¤ ê·¸ë¶„ì„ ë§Œë‚  ìƒê°ì— ê°€ìŠ´ì´ ë›°ì—ˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ ì‚¬ë‘ì´ë¼ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ì„ ë•Œ, ë‹¹ì‹ ì€ ì´ ë§ˆìŒì„ ëˆ„êµ°ê°€ì—ê²Œ í„¸ì–´ë†“ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤..."
                },
                4: {
                    title: "ì§„ì‹¤ì˜ ìˆœê°„",
                    content: "ë‹¹ì‹ ì˜ í¸ì§€ë¥¼ ë°›ì€ í›„ì›ìëŠ” ê¹Šì€ ê³ ë¯¼ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤. ìì‹ ì´ ì‚¬ë‘í•˜ëŠ” ì˜ˆìˆ ê°€ê°€ ë‹¤ë¥¸ ëˆ„êµ°ê°€ë¥¼(ì‹¤ì œë¡œëŠ” ìì‹ ì„) ì‚¬ë‘í•œë‹¤ê³  ê³ ë°±í•œ ê²ƒì…ë‹ˆë‹¤. ì´ì œ ìì‹ ì˜ ì •ì²´ë¥¼ ë°í ë•Œê°€ ì˜¨ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤..."
                }
            };
            
            document.getElementById('storyTitle').textContent = stories[storyNum].title;
            document.getElementById('storyContent').textContent = stories[storyNum].content;
        }

        function continueToNextLetter() {
            document.getElementById('storySection').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'grid';
            
            // ë‹¤ìŒ í¸ì§€ì—ì„œëŠ” ê¸°ìˆ ì„ ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
            gameState.skillUsed = false;
            
            startLetter(gameState.currentLetter + 1);
        }

        function showEnding() {
            const finalScore = gameState.totalScore;
            let ending = '';
            
            if (finalScore >= 15) {
                ending = 'ì™„ë²½í•œ ì‚¬ë‘: ì„œë¡œì˜ ë§ˆìŒê³¼ ì •ì²´ë¥¼ í™•ì¸í•˜ê³  ì‚¬ë‘í•˜ê²Œ ë¨';
            } else if (finalScore >= 10) {
                ending = 'ë¹„í„°ìŠ¤ìœ„íŠ¸: ì„œë¡œì˜ ë§ˆìŒê³¼ ì •ì²´ëŠ” í™•ì¸í•˜ì§€ë§Œ ì‹ ë¶„ ì°¨ì´ë¥¼ ê·¹ë³µí•  ìš©ê¸°ë¥¼ ë‚´ì§€ ëª»í•¨';
            } else {
                ending = 'ë¯¸ì™„ì˜ ì‚¬ë‘: ì„œë¡œì˜ ì •ì²´ì™€ ë§ˆìŒì„ í™•ì¸í•˜ì§€ ëª»í•˜ê³  í›„ì›ìì™€ í”¼í›„ì›ìì˜ ê´€ê³„ë¡œ ë‚¨ê²Œë¨';
            }
            
            // ìµœì¢… í¸ì§€ í‘œì‹œë¥¼ ìœ„í•´ ì™„ë£Œ ìƒíƒœë¡œ ì„¤ì •
            gameState.currentParagraph = 6;
            updateLetterContainer();
            
            setTimeout(() => {
                alert(`ê²Œì„ ì¢…ë£Œ!\n\n${gameState.character.name}ì˜ ì´ì•¼ê¸°\nì´ì : ${finalScore}ì \n\nê²°ë§: ${ending}`);
            }, 500);
        }
    </script>
</body>
</html>
